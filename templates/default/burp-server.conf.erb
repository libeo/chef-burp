# Generated by Chef for <%= node['fqdn'] %>
# Changes will be overwritten

mode = server
port = <%= node['burp']['port'] %>
status_port = <%= node['burp']['statusport'] %>

# Run as different user/group.
user = burp
group = burp

directory = /var/spool/burp
clientconfdir = /etc/burp/clientconfdir
pidfile = <%= node['burp']['server_only']['pidfile'] %>

hardlinked_archive = <%= node['burp']['server_only']['hardlinked_archive'] ? "1" : "0" %>
working_dir_recovery_method = resume
max_children = <%= node['burp']['max_children'] %>
max_status_children = <%= node['burp']['max_status_children'] %>
umask = 0027

syslog = 1
stdout = 0

strip_vss=1

client_can_delete = 0
client_can_force_backup = <%= node[:burp][:server_only][:client_can_force_backup] ? "1" : "0" %>
client_can_list = 1
client_can_restore = 1
client_can_verify = 1

# You can have as many 'keep' lines as you like.
# Setting 7, 4, 6 will keep 7 daily backups, 4 weekly, and 6 four-weekly
# backups.
keep = 8
keep = 4
keep = 6


<% if node['burp']['server_only']['ratelimit_server'] == "yes" %>
# Ratelimit throttles the send speed. Specified in Megabits per second (Mb/s).
ratelimit = <%= node['burp']['server_only']['ratelimit_server_mbps'] %>
<% end %>

network_timeout = <%= node['burp']['network_timeout'] %>

version_warn = 1

# More configuration files can be read, using syntax like the following
# (without the leading '# ').
# . path/to/more/conf

# Location of autoupgrade files to serve to clients. Leave it commented out
# to not autoupgrade clients.
# autoupgrade_dir = /etc/burp/autoupgrade/server




# CA options.
# If you want your server to be a certificate authority and generate its own
# certificates, uncomment the following lines. If the directory specified in
# ca_conf does not exist, the server will create, populate it, and the paths
# indicated by ssl_cert_ca, ssl_cert, ssl_key and ssl_dhfile below will be
# overwritten. See docs/burp_ca.txt for more information.
ca_conf = /etc/burp/CA.cnf
ca_name = burpCA
ca_server_name = <%= node['burp']['ca_server_name'] %>
ca_burp_ca = /usr/sbin/burp_ca

# SSL certificate authority - same file on both server and client
ssl_cert_ca = /etc/burp/ssl_cert_ca.pem

# Server SSL certificate
ssl_cert = /etc/burp/ssl_cert-server.pem

# Server SSL key
ssl_key = /etc/burp/ssl_cert-server.key

# Server SSL ciphers
ssl_ciphers = DHE-RSA-AES256-SHA

# SSL key password
ssl_key_password = password

# Server DH file.
ssl_dhfile = /etc/burp/dhfile.pem

timer_script = /etc/burp/timer_script
# Ensure that 20 hours elapse between backups
# Available units:
# s (seconds), m (minutes), h (hours), d (days), w (weeks), n (months)
timer_arg = 20h
# Allow backups to start in the evenings and nights during weekdays
timer_arg = Mon,Tue,Wed,Thu,Fri,00,01,02,03,04,05,06,07,08,17,18,19,20,21,22,23
# Allow more hours at the weekend.
timer_arg = Sat,Sun,00,01,02,03,04,05,06,07,08,17,18,19,20,21,22,23

# Uncomment the notify_success_* lines for email notifications of backups that
# succeeded.
# In the subject line, the following are substituted:
# %b - "backup"/"restore"/"verify"
# %c - client name
# %w - number of warnings, if any
notify_success_script = /etc/burp/notify_script
# sendmail -t has problems on certain MTAs e.g. Exim4
notify_success_arg = sendmail
notify_success_arg = To: <%= node['burp']['server_only']['notify_success_mail'] %>
notify_success_arg = From: burp
notify_success_arg = Subject: %b succeeded: %c %w
# Uncomment the following to have success notifications only if there were
# warnings.
notify_success_warnings_only = 1
# Uncomment the following to have success notifications only if there were
# new or changed files.
#notify_success_changes_only = 1

# Uncomment the following for email notifications of backups that failed.
notify_failure_script = /etc/burp/notify_script
# sendmail -t has problems on certain MTAs e.g. Exim4
notify_failure_arg = sendmail
notify_failure_arg = To: <%= node['burp']['server_only']['notify_failure_mail'] %>
notify_failure_arg = From: burp
notify_failure_arg = Subject: %b failed: %c %w

# The server can run scripts on each connection after authentication and before
# disconnecting.
#server_script_pre = /etc/burp/ssl_extra_checks_script
#server_script_pre_arg = /etc/burp/crl
#server_script_pre_arg = /etc/burp/burp-server.conf
#server_script_pre_arg = /etc/burp/server-pre-script.local



<% unless node['burp']['server_only']['restore_client'].empty? -%>
# Clients that are able to list and restore files belonging to any other
# client. If this is too permissive, you may set a restore_client for
# individual original clients in the individual clientconfdir files.
  <% node['burp']['server_only']['restore_client'].each do |restore_client| -%>
restore_client = <%= restore_client %>
  <% end -%>
<% end -%>

